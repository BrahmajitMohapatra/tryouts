#!/usr/bin/ruby

TRYOUTS_HOME = File.expand_path(File.join(File.dirname(__FILE__), '..'))

$:.unshift File.join(TRYOUTS_HOME, 'lib')

local_libs = %w{tryouts net-scp amazon-ec2 aws-s3 caesars drydock rye storable sysinfo annoy}
local_libs.each { |dir| $:.unshift File.join(TRYOUTS_HOME, '..', dir, 'lib') }

require 'drydock'
require 'tryouts'
require 'tryouts/cli'

# = TryoutsCLI
#
# This is the Drydock definition for the bin/tryouts executable
module TryoutsCLI
  extend Drydock
  
  debug :on
  default :run, :with_args
  
  global :q, :quiet, "Decrease output"
  global :V, :version, "Display version number" do
    puts "Tryouts version: #{Tryouts::VERSION}"
    exit 0
  end
  global :v, :verbose, "Increase output" do 
    @verbose ||= 0
    @verbose += 1
  end
  
  about "Run tryouts from current working directory"
  argv :files
  option :q, :quiet, "Decrease output (same as global)"
  option :v, :verbose, "Increase output (same as global)" do 
    @verbose ||= 0
    @verbose += 1
  end
  command :run => Tryouts::CLI::Run
  
  about "Show dreams available from the current working directory"
  argv :files
  option :q, :quiet, "Decrease output (same as global)"
  option :v, :verbose, "Increase output (same as global)" do 
    @verbose ||= 0
    @verbose += 1
  end
  command :dreams => Tryouts::CLI::Run
  
  about "Show tryouts available from the current working directory"
  argv :files
  option :q, :quiet, "Decrease output (same as global)"
  option :v, :verbose, "Increase output (same as global)" do 
    @verbose ||= 0
    @verbose += 1
  end
  command :list => Tryouts::CLI::Run
  
end

Drydock.run!(ARGV, STDIN) if Drydock.run?
